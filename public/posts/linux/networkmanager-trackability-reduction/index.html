<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>NetworkManager Trackability Reduction | PrivSec - A practical approach to Privacy and Security</title><meta name=keywords content="Operating Systems,Linux,Privacy"><meta name=description content="MAC address randomization Note that Ethernet connections can still be tracked via switch ports, and WiFi connections can be broadly localized by access point.
Furthermore, MAC address spoofing and randomization depends on firmware support from the interface. Most modern network interface cards support the feature.
There are three different aspects of MAC address randomization in NetworkManager, each with their own configuration flag:
WiFi scanning [device] wifi.scan-rand-mac-address=yes WiFi connections [connection] wifi.cloned-mac-address=<mode> Ethernet connections [connection] ethernet."><meta name=author content="WfKe9vLwSvv7rN"><link rel=canonical href=https://wanderingcomputerer.gitlab.io/guides/tips/nm-hardening/><link crossorigin=anonymous href=/assets/css/stylesheet.c5277e43fde8b6dabe803dff75b3c935ba15f1a218d18c0bcbaba3460636ce74.css integrity="sha256-xSd+Q/3ottq+gD3/dbPJNboV8aIY0YwLy6ujRgY2znQ=" rel="preload stylesheet" as=style><noscript><link crossorigin=anonymous href=/css/includes/noscript.30127fa68e36d08f5dd7f9d4e717dac42e729b844672afd0fbcacb0d9e508595.css integrity="sha256-MBJ/po420I9d1/nU5xfaxC5ym4RGcq/Q+8rLDZ5QhZU=" rel="preload stylesheet" as=style></noscript><link rel=icon href=https://privsec.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://privsec.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://privsec.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://privsec.dev/apple-touch-icon.png><link rel=mask-icon href=https://privsec.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta property="og:title" content="NetworkManager Trackability Reduction"><meta property="og:description" content="MAC address randomization Note that Ethernet connections can still be tracked via switch ports, and WiFi connections can be broadly localized by access point.
Furthermore, MAC address spoofing and randomization depends on firmware support from the interface. Most modern network interface cards support the feature.
There are three different aspects of MAC address randomization in NetworkManager, each with their own configuration flag:
WiFi scanning [device] wifi.scan-rand-mac-address=yes WiFi connections [connection] wifi.cloned-mac-address=<mode> Ethernet connections [connection] ethernet."><meta property="og:type" content="article"><meta property="og:url" content="https://privsec.dev/posts/linux/networkmanager-trackability-reduction/"><meta property="og:image" content="https://privsec.dev/privsec.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-04T00:00:00+00:00"><meta property="article:modified_time" content="2023-02-04T16:21:06-05:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://privsec.dev/privsec.png"><meta name=twitter:title content="NetworkManager Trackability Reduction"><meta name=twitter:description content="MAC address randomization Note that Ethernet connections can still be tracked via switch ports, and WiFi connections can be broadly localized by access point.
Furthermore, MAC address spoofing and randomization depends on firmware support from the interface. Most modern network interface cards support the feature.
There are three different aspects of MAC address randomization in NetworkManager, each with their own configuration flag:
WiFi scanning [device] wifi.scan-rand-mac-address=yes WiFi connections [connection] wifi.cloned-mac-address=<mode> Ethernet connections [connection] ethernet."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Categories","item":"https://privsec.dev/posts/"},{"@type":"ListItem","position":3,"name":"Linux","item":"https://privsec.dev/posts/linux/"},{"@type":"ListItem","position":4,"name":"NetworkManager Trackability Reduction","item":"https://privsec.dev/posts/linux/networkmanager-trackability-reduction/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"NetworkManager Trackability Reduction","name":"NetworkManager Trackability Reduction","description":"MAC address randomization Note that Ethernet connections can still be tracked via switch ports, and WiFi connections can be broadly localized by access point.\nFurthermore, MAC address spoofing and randomization depends on firmware support from the interface. Most modern network interface cards support the feature.\nThere are three different aspects of MAC address randomization in NetworkManager, each with their own configuration flag:\nWiFi scanning [device] wifi.scan-rand-mac-address=yes WiFi connections [connection] wifi.cloned-mac-address=\u0026lt;mode\u0026gt; Ethernet connections [connection] ethernet.","keywords":["Operating Systems","Linux","Privacy"],"articleBody":"MAC address randomization Note that Ethernet connections can still be tracked via switch ports, and WiFi connections can be broadly localized by access point.\nFurthermore, MAC address spoofing and randomization depends on firmware support from the interface. Most modern network interface cards support the feature.\nThere are three different aspects of MAC address randomization in NetworkManager, each with their own configuration flag:\nWiFi scanning [device] wifi.scan-rand-mac-address=yes WiFi connections [connection] wifi.cloned-mac-address= Ethernet connections [connection] ethernet.cloned-mac-address= Mode options random: Generate a new random MAC address every time a connection is activated\nstable: Assign each connection a random MAC address that will be maintained across activations\npreserve: Use the MAC address already assigned to the interface (such as from macchanger), or the permanent address if none is assigned\npermanent: Use the MAC address permanently baked into the hardware\nSetting a default configuration It’s best to create a dedicated configuration file, such as /etc/NetworkManager/conf.d/99-random-mac.conf, to ensure package updates do not overwrite the configuration. In general, I recommend the following:\n[device] wifi.scan-rand-mac-address=yes [connection] wifi.cloned-mac-address=random ethernet.cloned-mac-address=random This configuration randomizes all MAC addresses by default. These settings can of course be overridden on a per-connection basis.\nAfter editing the file, run sudo nmcli general reload conf to apply the new configuration.\nPer-connection overrides Connection-specific settings take precedence over configuration file defaults. They can be set through nm-connection-editor (“Network Connections”), a DE-specific network settings GUI, nmtui, or nmcli.\nLook for “Cloned MAC address” under the “Wi-Fi” or “Ethernet” section:\nIn addition to the four mode keywords, you can input an exact MAC address to be used for that connection.\nFor a home or other trusted network, it can be helpful to use stable or even permanent, as MAC address stability can help avoid being repeatedly served a new IP address and DHCP lease (though not all DHCP servers work this way).\nFor public networks with captive portals (webpages that must be accessed to gain network access), the stable setting can help prevent redirection back to the captive portal after a brief disconnection or roaming to a different access point.\nSeeing the randomized MAC address Activate the connection in question, and then look for GENERAL.HWADDR in the output of nmcli device show. This represents the MAC address currently in use by the interface, whether randomized or not. It is also visible as “Hardware Address” (or similar) in NetworkManager GUIs under active connection details.\n$ nmcli device show GENERAL.DEVICE: enp5s0 GENERAL.TYPE: ethernet GENERAL.HWADDR: XX:XX:XX:XX:XX:XX GENERAL.DEVICE: wlp3s0 GENERAL.TYPE: wifi GENERAL.HWADDR: XX:XX:XX:XX:XX:XX  Remove static hostname to prevent hostname broadcast sudo hostnamectl hostname \"localhost\" An empty (blank) hostname is also an option, but a static hostname of “localhost” is less likely to cause breakage. Both will result in no hostname being broadcasted to the DHCP server.\nDisabling transient hostname management It’s best to create a dedicated configuration file, such as /etc/NetworkManager/conf.d/01-transient-hostname.conf, to ensure package updates do not overwrite the configuration:\n[main] hostname-mode=none This will prevent NetworkManager from setting transient hostnames that may be provided by some DHCP servers. This will have no visible effect except with an empty static hostname.\nAfter editing the file, run sudo nmcli general reload conf to apply the new configuration. Run sudo hostnamectl --transient hostname \"\" to reset the transient hostname.\n Disable sending hostname to DHCP server This configuration will leak your hostname on first connection. Setting a generic or random hostname is strongly recommended if possible.\nDue to limitations in NetworkManager, it is not possible to reliably disable sending hostnames by default. This setup is very much a hack.\nDue to being leaky, this configuration is virtually useless without also randomizing MAC addresses by default. Your MAC address and hostname will not be correlated starting with the second connection, assuming the first connection used a random MAC address.\nCreate /etc/NetworkManager/dispatcher.d/no-wait.d/01-no-send-hostname.sh as follows:\n#!/bin/sh  if [ \"$(nmcli -g 802-11-wireless.cloned-mac-address c show \"$CONNECTION_UUID\")\" = 'permanent' ] \\  || [ \"$(nmcli -g 802-3-ethernet.cloned-mac-address c show \"$CONNECTION_UUID\")\" = 'permanent' ] then nmcli connection modify \"$CONNECTION_UUID\" \\  ipv4.dhcp-send-hostname true \\  ipv6.dhcp-send-hostname true else nmcli connection modify \"$CONNECTION_UUID\" \\  ipv4.dhcp-send-hostname false \\  ipv6.dhcp-send-hostname false fi The script must have specific file permissions and a symlink to take effect:\ncd /etc/NetworkManager/dispatcher.d/ sudo chown root:root no-wait.d/01-no-send-hostname.sh sudo chmod 744 no-wait.d/01-no-send-hostname.sh sudo ln -s no-wait.d/01-no-send-hostname.sh ./ This script will be automatically triggered on connection events to modify the connection’s dhcp-send-hostname settings. If the connection’s cloned MAC address is explicitly overridden to permanent, the hostname will be sent to the DHCP server on future connections. In all other cases, the hostname will be masked on future connections, so the DHCP server will only see the MAC address.\nVerifying proper operation After initiating first connection with a network:\n$ nmcli c show  | grep dhcp-send-hostname ipv4.dhcp-send-hostname: no ipv6.dhcp-send-hostname: no  can be the connection name (usually the SSID for WiFi networks) or UUID, obtained from nmcli c show [--active].\nRecall that these setting values are set based on the previous connection activation and take effect for the next connection activation.\n Sources  ArchWiki — NetworkManager hostnamectl man page MAC Address Spoofing in NetworkManager 1.4.0 NetworkManager.conf man page NetworkManager-dispatcher man page NetworkManager: Disable Sending Hostname to DHCP Server nmcli man page  ","wordCount":"852","inLanguage":"en","datePublished":"2022-09-04T00:00:00Z","dateModified":"2023-02-04T16:21:06-05:00","author":{"@type":"Person","name":"WfKe9vLwSvv7rN"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://privsec.dev/posts/linux/networkmanager-trackability-reduction/"},"publisher":{"@type":"Organization","name":"PrivSec - A practical approach to Privacy and Security","logo":{"@type":"ImageObject","url":"https://privsec.dev/favicon.ico"}}}</script></head><body class=dark id=top><script crossorigin=anonymous src=/assets/js/theme.b20f95bb4da41ef90a2610a557a7000b2649a3f47282ec571676da6fc0427200.js integrity="sha256-sg+Vu02kHvkKJhClV6cACyZJo/RyguxXFnbab8BCcgA="></script><header class=header><div id=progressBar></div><nav class=nav><div class=logo><a href=https://privsec.dev accesskey=h title="PrivSec (Alt + H)"><img src=https://privsec.dev/privsec.png alt aria-label=logo height=30>PrivSec</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><input id=hamburger-input type=checkbox></input>
<label id=hamburger-menu for=hamburger-input></label><div class=overlay></div><ul id=menu><li><a href=https://privsec.dev/posts/ title=Categories><span>Categories</span></a></li><li><a href=https://privsec.dev/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://privsec.dev/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://privsec.dev/resources title=Resources><span>Resources</span></a></li><li><a href=https://tommytran.io/tommy.asc title=PGP><span>PGP</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://tommytran.io/tommy.crt title=S/MIME><span>S/MIME</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://privsec.dev>Home</a>&nbsp;»&nbsp;<a href=https://privsec.dev/posts/>Categories</a>&nbsp;»&nbsp;<a href=https://privsec.dev/posts/linux/>Linux</a></div><h1 class=post-title>NetworkManager Trackability Reduction</h1><div class=post-meta><span title='2022-09-04 00:00:00 +0000 UTC'>September 4, 2022</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;852 words&nbsp;·&nbsp;WfKe9vLwSvv7rN&nbsp;|&nbsp;<a href=https://github.com/PrivSec-dev/privsec.dev/blob/main/content/posts/linux/NetworkManager%20Trackability%20Reduction.md rel="noopener noreferrer">Suggest Changes</a>
&nbsp;|&nbsp;<span>Originally published at&nbsp;<a href=https://wanderingcomputerer.gitlab.io/guides/tips/nm-hardening/ title=https://wanderingcomputerer.gitlab.io/guides/tips/nm-hardening/ rel="noopener noreferrer">wanderingcomputerer.gitlab.io</a></span></div><div class=post-meta><span title="2023-02-04 16:21:06 -0500 EST"><i>Last updated on February 4, 2023</i></span></div></header><div class="toc side"><details id=toc><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#mac-address-randomization aria-label="MAC address randomization">MAC address randomization</a><ul><ul><li><a href=#wifi-scanning aria-label="WiFi scanning">WiFi scanning</a></li><li><a href=#wifi-connections aria-label="WiFi connections">WiFi connections</a></li><li><a href=#ethernet-connections aria-label="Ethernet connections">Ethernet connections</a></li><li><a href=#mode-options aria-label="Mode options">Mode options</a></li></ul><li><a href=#macrand-default-configuration aria-label="Setting a default configuration">Setting a default configuration</a></li><li><a href=#per-connection-overrides aria-label="Per-connection overrides">Per-connection overrides</a></li><li><a href=#seeing-the-randomized-mac-address aria-label="Seeing the randomized MAC address">Seeing the randomized MAC address</a></li></ul></li><li><a href=#remove-static-hostname-to-prevent-hostname-broadcast aria-label="Remove static hostname to prevent hostname broadcast">Remove static hostname to prevent hostname broadcast</a><ul><li><a href=#rmhostname-transient aria-label="Disabling transient hostname management">Disabling transient hostname management</a></li></ul></li><li><a href=#disable-sending-hostname-to-dhcp-server aria-label="Disable sending hostname to DHCP server">Disable sending hostname to DHCP server</a><ul><li><a href=#verifying-proper-operation aria-label="Verifying proper operation">Verifying proper operation</a></li></ul></li><li><a href=#sources aria-label=Sources>Sources</a></li></ul></div></details></div><div class=post-content><h2 id=mac-address-randomization>MAC address randomization<a hidden class=anchor aria-hidden=true href=#mac-address-randomization>#</a></h2><p>Note that Ethernet connections can still be tracked via switch ports, and WiFi connections can be broadly localized by access point.</p><p>Furthermore, MAC address spoofing and randomization depends on firmware support from the interface. Most modern network interface cards support the feature.</p><p>There are three different aspects of MAC address randomization in NetworkManager, each with their own configuration flag:</p><h4 id=wifi-scanning>WiFi scanning<a hidden class=anchor aria-hidden=true href=#wifi-scanning>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[device]
</span></span><span class=line><span class=cl>wifi.scan-rand-mac-address=yes
</span></span></code></pre></div><h4 id=wifi-connections>WiFi connections<a hidden class=anchor aria-hidden=true href=#wifi-connections>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[connection]
</span></span><span class=line><span class=cl>wifi.cloned-mac-address=&lt;mode&gt;
</span></span></code></pre></div><h4 id=ethernet-connections>Ethernet connections<a hidden class=anchor aria-hidden=true href=#ethernet-connections>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[connection]
</span></span><span class=line><span class=cl>ethernet.cloned-mac-address=&lt;mode&gt;
</span></span></code></pre></div><h4 id=mode-options>Mode options<a hidden class=anchor aria-hidden=true href=#mode-options>#</a></h4><p><code>random</code>: Generate a new random MAC address every time a connection is activated</p><p><code>stable</code>: Assign each connection a random MAC address that will be maintained across activations</p><p><code>preserve</code>: Use the MAC address already assigned to the interface (such as from <code>macchanger</code>), or the permanent address if none is assigned</p><p><code>permanent</code>: Use the MAC address permanently baked into the hardware</p><h3 id=macrand-default-configuration>Setting a default configuration<a hidden class=anchor aria-hidden=true href=#macrand-default-configuration>#</a></h3><p>It&rsquo;s best to create a dedicated configuration file, such as <code>/etc/NetworkManager/conf.d/99-random-mac.conf</code>, to ensure package updates do not overwrite the configuration. In general, I recommend the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[device]
</span></span><span class=line><span class=cl>wifi.scan-rand-mac-address=yes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[connection]
</span></span><span class=line><span class=cl>wifi.cloned-mac-address=random
</span></span><span class=line><span class=cl>ethernet.cloned-mac-address=random
</span></span></code></pre></div><p>This configuration randomizes all MAC addresses by default. These settings can of course be <a href=#per-connection-overrides>overridden on a per-connection basis</a>.</p><p>After editing the file, run <code>sudo nmcli general reload conf</code> to apply the new configuration.</p><h3 id=per-connection-overrides>Per-connection overrides<a hidden class=anchor aria-hidden=true href=#per-connection-overrides>#</a></h3><p>Connection-specific settings take precedence over configuration file defaults. They can be set through <code>nm-connection-editor</code> (&ldquo;Network Connections&rdquo;), a DE-specific network settings GUI, <code>nmtui</code>, or <code>nmcli</code>.</p><p>Look for &ldquo;Cloned MAC address&rdquo; under the &ldquo;Wi-Fi&rdquo; or &ldquo;Ethernet&rdquo; section:</p><p><img loading=lazy src=/images/nm-connection-editor.webp alt="nm-connection-editor screenshot"></p><p>In addition to the four mode keywords, you can input an exact MAC address to be used for that connection.</p><p>For a home or other trusted network, it can be helpful to use <code>stable</code> or even <code>permanent</code>, as MAC address stability can help avoid being repeatedly served a new IP address and DHCP lease (though not all DHCP servers work this way).</p><p>For public networks with captive portals (webpages that must be accessed to gain network access), the <code>stable</code> setting can help prevent redirection back to the captive portal after a brief disconnection or roaming to a different access point.</p><h3 id=seeing-the-randomized-mac-address>Seeing the randomized MAC address<a hidden class=anchor aria-hidden=true href=#seeing-the-randomized-mac-address>#</a></h3><p>Activate the connection in question, and then look for <code>GENERAL.HWADDR</code> in the output of <code>nmcli device show</code>. This represents the MAC address currently in use by the interface, whether randomized or not. It is also visible as &ldquo;Hardware Address&rdquo; (or similar) in NetworkManager GUIs under active connection details.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ nmcli device show
</span></span><span class=line><span class=cl>GENERAL.DEVICE:                         enp5s0
</span></span><span class=line><span class=cl>GENERAL.TYPE:                           ethernet
</span></span><span class=line><span class=cl>GENERAL.HWADDR:                         XX:XX:XX:XX:XX:XX
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>GENERAL.DEVICE:                         wlp3s0
</span></span><span class=line><span class=cl>GENERAL.TYPE:                           wifi
</span></span><span class=line><span class=cl>GENERAL.HWADDR:                         XX:XX:XX:XX:XX:XX
</span></span></code></pre></div><hr><h2 id=remove-static-hostname-to-prevent-hostname-broadcast>Remove static hostname to prevent hostname broadcast<a hidden class=anchor aria-hidden=true href=#remove-static-hostname-to-prevent-hostname-broadcast>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo hostnamectl hostname <span class=s2>&#34;localhost&#34;</span>
</span></span></code></pre></div><p>An empty (blank) hostname is also an option, but a static hostname of &ldquo;localhost&rdquo; is less likely to cause breakage. Both will result in no hostname being broadcasted to the DHCP server.</p><h3 id=rmhostname-transient>Disabling transient hostname management<a hidden class=anchor aria-hidden=true href=#rmhostname-transient>#</a></h3><p>It&rsquo;s best to create a dedicated configuration file, such as <code>/etc/NetworkManager/conf.d/01-transient-hostname.conf</code>, to ensure package updates do not overwrite the configuration:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[main]
</span></span><span class=line><span class=cl>hostname-mode=none
</span></span></code></pre></div><p>This will prevent NetworkManager from setting transient hostnames that may be provided by some DHCP servers. This will have no visible effect except with an empty static hostname.</p><p>After editing the file, run <code>sudo nmcli general reload conf</code> to apply the new configuration. Run <code>sudo hostnamectl --transient hostname ""</code> to reset the transient hostname.</p><hr><h2 id=disable-sending-hostname-to-dhcp-server>Disable sending hostname to DHCP server<a hidden class=anchor aria-hidden=true href=#disable-sending-hostname-to-dhcp-server>#</a></h2><p><strong>This configuration will leak your hostname on first connection.</strong> Setting a generic or random hostname is strongly recommended if possible.</p><p>Due to <a href=https://gitlab.freedesktop.org/NetworkManager/NetworkManager/-/issues/584 title="NetworkManager issue: No way to set dhcp-send-hostname globally">limitations in NetworkManager</a>, it is not possible to reliably disable sending hostnames by default. This setup is very much a hack.</p><p>Due to being leaky, this configuration is virtually useless without also <a href=#macrand-default-configuration title="MAC address randomization — Setting a default configuration">randomizing MAC addresses by default</a>. Your MAC address and hostname will not be correlated starting with the second connection, assuming the first connection used a random MAC address.</p><p>Create <code>/etc/NetworkManager/dispatcher.d/no-wait.d/01-no-send-hostname.sh</code> as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=cp>#!/bin/sh
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=k>$(</span>nmcli -g 802-11-wireless.cloned-mac-address c show <span class=s2>&#34;</span><span class=nv>$CONNECTION_UUID</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span> <span class=o>=</span> <span class=s1>&#39;permanent&#39;</span> <span class=o>]</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        <span class=o>||</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=k>$(</span>nmcli -g 802-3-ethernet.cloned-mac-address c show <span class=s2>&#34;</span><span class=nv>$CONNECTION_UUID</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span> <span class=o>=</span> <span class=s1>&#39;permanent&#39;</span> <span class=o>]</span>
</span></span><span class=line><span class=cl><span class=k>then</span>
</span></span><span class=line><span class=cl>    nmcli connection modify <span class=s2>&#34;</span><span class=nv>$CONNECTION_UUID</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>            ipv4.dhcp-send-hostname <span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>            ipv6.dhcp-send-hostname <span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>    nmcli connection modify <span class=s2>&#34;</span><span class=nv>$CONNECTION_UUID</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>            ipv4.dhcp-send-hostname <span class=nb>false</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>            ipv6.dhcp-send-hostname <span class=nb>false</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></div><p>The script must have specific file permissions and a symlink to take effect:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /etc/NetworkManager/dispatcher.d/
</span></span><span class=line><span class=cl>sudo chown root:root no-wait.d/01-no-send-hostname.sh
</span></span><span class=line><span class=cl>sudo chmod <span class=m>744</span> no-wait.d/01-no-send-hostname.sh
</span></span><span class=line><span class=cl>sudo ln -s no-wait.d/01-no-send-hostname.sh ./
</span></span></code></pre></div><p>This script will be automatically triggered on connection events to modify the connection&rsquo;s <code>dhcp-send-hostname</code> settings. If the connection&rsquo;s <em>cloned MAC address</em> is <a href=#per-connection-overrides>explicitly overridden</a> to <code>permanent</code>, the hostname will be sent to the DHCP server on future connections. In all other cases, the hostname will be masked on future connections, so the DHCP server will only see the MAC address.</p><h3 id=verifying-proper-operation>Verifying proper operation<a hidden class=anchor aria-hidden=true href=#verifying-proper-operation>#</a></h3><p>After initiating first connection with a network:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ nmcli c show &lt;connection&gt; <span class=p>|</span> grep dhcp-send-hostname
</span></span><span class=line><span class=cl>ipv4.dhcp-send-hostname:                no
</span></span><span class=line><span class=cl>ipv6.dhcp-send-hostname:                no
</span></span></code></pre></div><p><code>&lt;connection></code> can be the connection name (usually the SSID for WiFi networks) or UUID, obtained from <code>nmcli c show [--active]</code>.</p><p><em>Recall that these setting values are set based on the previous connection activation and take effect for the next connection activation.</em></p><hr><h2 id=sources>Sources<a hidden class=anchor aria-hidden=true href=#sources>#</a></h2><ul><li><a href=https://wiki.archlinux.org/title/NetworkManager#Configuring_MAC_address_randomization>ArchWiki &mdash; NetworkManager</a></li><li><a href=https://www.freedesktop.org/software/systemd/man/hostnamectl>hostnamectl man page</a></li><li><a href=https://blogs.gnome.org/thaller/2016/08/26/mac-address-spoofing-in-networkmanager-1-4-0/>MAC Address Spoofing in NetworkManager 1.4.0</a></li><li><a href=https://networkmanager.dev/docs/api/latest/NetworkManager.conf.html>NetworkManager.conf man page</a></li><li><a href=https://networkmanager.dev/docs/api/latest/NetworkManager-dispatcher.html>NetworkManager-dispatcher man page</a></li><li><a href=https://viliampucik.blogspot.com/2016/09/networkmanager-disable-sending-hostname.html>NetworkManager: Disable Sending Hostname to DHCP Server</a></li><li><a href=https://networkmanager.dev/docs/api/latest/nmcli.html>nmcli man page</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://privsec.dev/tags/operating-systems/>Operating Systems</a></li><li><a href=https://privsec.dev/tags/linux/>Linux</a></li><li><a href=https://privsec.dev/tags/privacy/>Privacy</a></li></ul><nav class=paginav><a class=prev href=https://privsec.dev/posts/linux/linux-insecurities/><span class=title>« Prev</span><br><span>Linux Insecurities</span></a>
<a class=next href=https://privsec.dev/posts/linux/protonvpn-ip-leakage-on-linux-and-workaround/><span class=title>Next »</span><br><span>ProtonVPN IP Leakage on Linux and Workaround</span></a></nav></footer></article></main><footer class=footer><span><a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA 4.0</a></span>
<span>- Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer">Hugo</a> &
        <a href=https://github.com/Wonderfall/hugo-WonderMod/ rel=noopener>WonderMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script defer crossorigin=anonymous src=/assets/js/papermod.7ea300eda6d3653624a576fbc095ccd8a0c2977756acbe5de4114132a72cc7fa.js integrity="sha256-fqMA7abTZTYkpXb7wJXM2KDCl3dWrL5d5BFBMqcsx/o="></script></body></html>