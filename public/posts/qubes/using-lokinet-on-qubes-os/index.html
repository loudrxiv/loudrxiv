<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Using Lokinet on Qubes OS | PrivSec - A practical approach to Privacy and Security</title><meta name=keywords content="Applications,Qubes OS,Anonymity,Privacy"><meta name=description content="Lokinet is an Internet overlay network utilizing onion routing to provide anonymity for its users, similar to Tor network. This post will provide a quick (and non exhaustive) list of its pros and cons from an end user perspective and go over how to set it up on Qubes OS.
Advantages  Provides anonymity by removing trust in a service provider (as opposed to a traditional VPN) Better versatility than Tor by supporting any IP based protocols (Tor only supports TCP) Generally faster speed than the Tor Network  Disadvantages  Only works well on Debian-based distributions."><meta name=author content="Tommy"><link rel=canonical href=https://privsec.dev/posts/qubes/using-lokinet-on-qubes-os/><link crossorigin=anonymous href=/assets/css/stylesheet.c5277e43fde8b6dabe803dff75b3c935ba15f1a218d18c0bcbaba3460636ce74.css integrity="sha256-xSd+Q/3ottq+gD3/dbPJNboV8aIY0YwLy6ujRgY2znQ=" rel="preload stylesheet" as=style><noscript><link crossorigin=anonymous href=/css/includes/noscript.30127fa68e36d08f5dd7f9d4e717dac42e729b844672afd0fbcacb0d9e508595.css integrity="sha256-MBJ/po420I9d1/nU5xfaxC5ym4RGcq/Q+8rLDZ5QhZU=" rel="preload stylesheet" as=style></noscript><link rel=icon href=https://privsec.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://privsec.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://privsec.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://privsec.dev/apple-touch-icon.png><link rel=mask-icon href=https://privsec.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta property="og:title" content="Using Lokinet on Qubes OS"><meta property="og:description" content="Lokinet is an Internet overlay network utilizing onion routing to provide anonymity for its users, similar to Tor network. This post will provide a quick (and non exhaustive) list of its pros and cons from an end user perspective and go over how to set it up on Qubes OS.
Advantages  Provides anonymity by removing trust in a service provider (as opposed to a traditional VPN) Better versatility than Tor by supporting any IP based protocols (Tor only supports TCP) Generally faster speed than the Tor Network  Disadvantages  Only works well on Debian-based distributions."><meta property="og:type" content="article"><meta property="og:url" content="https://privsec.dev/posts/qubes/using-lokinet-on-qubes-os/"><meta property="og:image" content="https://privsec.dev/privsec.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-27T00:00:00+00:00"><meta property="article:modified_time" content="2023-02-04T16:21:06-05:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://privsec.dev/privsec.png"><meta name=twitter:title content="Using Lokinet on Qubes OS"><meta name=twitter:description content="Lokinet is an Internet overlay network utilizing onion routing to provide anonymity for its users, similar to Tor network. This post will provide a quick (and non exhaustive) list of its pros and cons from an end user perspective and go over how to set it up on Qubes OS.
Advantages  Provides anonymity by removing trust in a service provider (as opposed to a traditional VPN) Better versatility than Tor by supporting any IP based protocols (Tor only supports TCP) Generally faster speed than the Tor Network  Disadvantages  Only works well on Debian-based distributions."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Categories","item":"https://privsec.dev/posts/"},{"@type":"ListItem","position":3,"name":"Qubes OS","item":"https://privsec.dev/posts/qubes/"},{"@type":"ListItem","position":4,"name":"Using Lokinet on Qubes OS","item":"https://privsec.dev/posts/qubes/using-lokinet-on-qubes-os/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Using Lokinet on Qubes OS","name":"Using Lokinet on Qubes OS","description":"Lokinet is an Internet overlay network utilizing onion routing to provide anonymity for its users, similar to Tor network. This post will provide a quick (and non exhaustive) list of its pros and cons from an end user perspective and go over how to set it up on Qubes OS.\nAdvantages  Provides anonymity by removing trust in a service provider (as opposed to a traditional VPN) Better versatility than Tor by supporting any IP based protocols (Tor only supports TCP) Generally faster speed than the Tor Network  Disadvantages  Only works well on Debian-based distributions.","keywords":["Applications","Qubes OS","Anonymity","Privacy"],"articleBody":"Lokinet is an Internet overlay network utilizing onion routing to provide anonymity for its users, similar to Tor network. This post will provide a quick (and non exhaustive) list of its pros and cons from an end user perspective and go over how to set it up on Qubes OS.\nAdvantages  Provides anonymity by removing trust in a service provider (as opposed to a traditional VPN) Better versatility than Tor by supporting any IP based protocols (Tor only supports TCP) Generally faster speed than the Tor Network  Disadvantages  Only works well on Debian-based distributions. The client for Windows has DNS Leaks, and support for macOS, Android, and other Linux distributions is experimental. It should be noted that this is a problem with the official client, not the protocol itself. Does not have a killswitch which could lead to accidental leaks (as opposed to common commercial VPN clients which lock the connections to just the provider’s servers). The official client requires a user to manually define an exit node, or to set certain IP ranges to be routed through certain exit nodes. While this makes it possible to setup some form of Steam Isolation, it is not as good as Tor’s isolateDestinationAddr and isolateDesitnationPort. which automatically use a random exit node for every destination/port you visit. DNS does not work when used as a ProxyVM on Qubes OS  Creating the TemplateVM As mentioned above, the Lokinet client only works well with Debian-based distributions. This means that our template will have to be one of the Debian-based ones, and I would highly recommend that you convert the official Debian template by the Qubes OS team into a KickSecure template to use as a base. KickSecure reduces the attack surface of Debian with a substantial set of hardening configurations, and a nice feature to go with an anonymity network like Lokinet is Boot Clock Randomization which helps defend against time-based denonymization attacks. You will only need the kicksecure-cli meta package (kicksecure-gui is unnecessary), and experimental services like proc-hidepid, hide-hardware-info and permission-hardening work just fine with the Lokinet client. Hardened Malloc and LKRG do not cause any problem with Lokinet, either.\nSince DNS with Lokinet does not work if it is installed inside of a ProxyVM, we will need to have Lokinet running inside the same AppVM as the applications you intend to run. This is less than ideal, as a compromised AppVM could reveal your IP address. Beyond that, accidental leaks can happen, too.\nA potential solution to this problem is to set up an unbound server or firewall script redirecting all DNS traffic to the ProxyVM to its Lokinet DNS server at 127.3.2.1:53; however, I have been unable to get it working. Another solution is to simply override the DNS server inside the AppVM to a custom DNS server, but this will make you stand out out and break .loki DNS resolution. Websites like DNS leak test can observe which DNS server you are actually using and potentially fingerprint you. For the same reason that you should not use custom DNS servers when connected to the Tor network, you really should not use a custom DNS server when connected to Lokinet.\nStart by importing the Oxen’s PGP key:\nsudo curl --proxy http://127.0.0.1:8082 -so /etc/apt/trusted.gpg.d/oxen.gpg https://deb.oxen.io/pub.gpg\nThen, add Oxen’s Debian repository:\necho \"deb https://deb.oxen.io $(lsb_release -sc) main\" | sudo tee /etc/apt/sources.list.d/oxen.list\nNext, update the repositories:\nsudo apt update\nIf updates for your packages are found, DO NOT attempt to upgrade them directly. Instead, use the Qubes Updater to update the TemplateVM.\nWhen you are done, install lokinet-gui and resolvconf:\nsudo apt install lokinet-gui resolvconf\nNote that you must install resolveconf to get DNS working.\nNext, edit /var/lib/lokinet/lokinet.ini and add the exit server you want to use:\nexit-node=exit.loki\nNote that I am using exit.loki here, as it is the one mentioned in the Lokinet documentation. There are some other exit servers listed on probably.loki as well, and for your convenience, I will just copy-paste them here:\n exit.loki (USA, run by Jeff) exit2.loki (USA, run by Jeff, same ip as exit.loki) xite.loki (Iceland, run by Loutchi) peter.loki (USA, run by peter) secret.loki (Netherlands, run by Secret)  Finally, enable the lokinet service:\nsystemctl enable lokinet\nCreating the AppVM Just create the AppVM as usual, and you would be good to go. There are a few things to keep in mind though:\n You should probably set networking to use sys-firewall. I have tested using my ProtonVPN ProxyVM for networking, and DNS was not working. Besides, it makes little sense to attempt such setup anyways, unless you are worried about accidental leaks or a compromised AppVM. You should give the AppVM the network-manager service so that Lokinet can set up networking properly and get DNS working.  ","wordCount":"788","inLanguage":"en","datePublished":"2022-07-27T00:00:00Z","dateModified":"2023-02-04T16:21:06-05:00","author":{"@type":"Person","name":"Tommy"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://privsec.dev/posts/qubes/using-lokinet-on-qubes-os/"},"publisher":{"@type":"Organization","name":"PrivSec - A practical approach to Privacy and Security","logo":{"@type":"ImageObject","url":"https://privsec.dev/favicon.ico"}}}</script></head><body class=dark id=top><script crossorigin=anonymous src=/assets/js/theme.b20f95bb4da41ef90a2610a557a7000b2649a3f47282ec571676da6fc0427200.js integrity="sha256-sg+Vu02kHvkKJhClV6cACyZJo/RyguxXFnbab8BCcgA="></script><header class=header><div id=progressBar></div><nav class=nav><div class=logo><a href=https://privsec.dev accesskey=h title="PrivSec (Alt + H)"><img src=https://privsec.dev/privsec.png alt aria-label=logo height=30>PrivSec</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><input id=hamburger-input type=checkbox></input>
<label id=hamburger-menu for=hamburger-input></label><div class=overlay></div><ul id=menu><li><a href=https://privsec.dev/posts/ title=Categories><span>Categories</span></a></li><li><a href=https://privsec.dev/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://privsec.dev/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://privsec.dev/resources title=Resources><span>Resources</span></a></li><li><a href=https://tommytran.io/tommy.asc title=PGP><span>PGP</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://tommytran.io/tommy.crt title=S/MIME><span>S/MIME</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://privsec.dev>Home</a>&nbsp;»&nbsp;<a href=https://privsec.dev/posts/>Categories</a>&nbsp;»&nbsp;<a href=https://privsec.dev/posts/qubes/>Qubes OS</a></div><h1 class=post-title>Using Lokinet on Qubes OS</h1><div class=post-meta><span title='2022-07-27 00:00:00 +0000 UTC'>July 27, 2022</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;788 words&nbsp;·&nbsp;Tommy&nbsp;|&nbsp;<a href=https://github.com/PrivSec-dev/privsec.dev/blob/main/content/posts/qubes/Using%20Lokinet%20on%20Qubes%20OS.md rel="noopener noreferrer">Suggest Changes</a></div><div class=post-meta><span title="2023-02-04 16:21:06 -0500 EST"><i>Last updated on February 4, 2023</i></span></div></header><div class="toc side"><details id=toc><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#advantages aria-label=Advantages>Advantages</a></li><li><a href=#disadvantages aria-label=Disadvantages>Disadvantages</a></li><li><a href=#creating-the-templatevm aria-label="Creating the TemplateVM">Creating the TemplateVM</a></li><li><a href=#creating-the-appvm aria-label="Creating the AppVM">Creating the AppVM</a></li></ul></div></details></div><div class=post-content><p><img loading=lazy src=/images/lokinet.png alt=Lokinet></p><p><a href=https://lokinet.org>Lokinet</a> is an Internet overlay network utilizing onion routing to provide anonymity for its users, similar to Tor network. This post will provide a quick (and non exhaustive) list of its <a href=#advantages>pros</a> and <a href=#disadvantages>cons</a> from an end user perspective and go over how to set it up on Qubes OS.</p><h2 id=advantages>Advantages<a hidden class=anchor aria-hidden=true href=#advantages>#</a></h2><ul><li>Provides anonymity by removing trust in a service provider (as opposed to a traditional VPN)</li><li>Better versatility than Tor by supporting any IP based protocols (Tor only supports TCP)</li><li>Generally faster speed than the Tor Network</li></ul><h2 id=disadvantages>Disadvantages<a hidden class=anchor aria-hidden=true href=#disadvantages>#</a></h2><ul><li>Only works well on Debian-based distributions. The client for Windows has DNS Leaks, and support for macOS, Android, and other Linux distributions is experimental. It should be noted that this is a problem with the official client, not the protocol itself.</li><li>Does not have a killswitch which could lead to accidental leaks (as opposed to common commercial VPN clients which lock the connections to just the provider&rsquo;s servers).</li><li>The official client requires a user to manually define an exit node, or to set certain IP ranges to be routed through certain exit nodes. While this makes it possible to setup some form of Steam Isolation, it is not as good as Tor&rsquo;s <code>isolateDestinationAddr</code> and <code>isolateDesitnationPort</code>. which automatically use a random exit node for every destination/port you visit.</li><li>DNS does not work when used as a ProxyVM on Qubes OS</li></ul><h2 id=creating-the-templatevm>Creating the TemplateVM<a hidden class=anchor aria-hidden=true href=#creating-the-templatevm>#</a></h2><p>As mentioned <a href=#disadvantages>above</a>, the Lokinet client only works well with Debian-based distributions. This means that our template will have to be one of the Debian-based ones, and I would highly recommend that you convert the official Debian template by the Qubes OS team into a KickSecure template to use as a base. KickSecure reduces the attack surface of Debian with a substantial set of hardening configurations, and a nice feature to go with an anonymity network like Lokinet is <a href=https://www.kicksecure.com/wiki/Boot_Clock_Randomization>Boot Clock Randomization</a> which helps defend against <a href=https://www.whonix.org/wiki/Time_Attacks>time-based denonymization attacks</a>. You will only need the <code>kicksecure-cli</code> meta package (<code>kicksecure-gui</code> is unnecessary), and experimental services like <code>proc-hidepid</code>, <code>hide-hardware-info</code> and <code>permission-hardening</code> work just fine with the Lokinet client. <a href=https://www.kicksecure.com/wiki/Hardened_Malloc>Hardened Malloc</a> and <a href=https://www.kicksecure.com/wiki/Linux_Kernel_Runtime_Guard_LKRG>LKRG</a> do not cause any problem with Lokinet, either.</p><p>Since DNS with Lokinet does not work if it is installed inside of a ProxyVM, we will need to have Lokinet running inside the same AppVM as the applications you intend to run. This is less than ideal, as a compromised AppVM could reveal your IP address. Beyond that, accidental leaks can happen, too.</p><p>A potential solution to this problem is to set up an unbound server or firewall script redirecting all DNS traffic to the ProxyVM to its Lokinet DNS server at <code>127.3.2.1:53</code>; however, I have been unable to get it working. Another solution is to simply override the DNS server inside the AppVM to a custom DNS server, but this will make you stand out out and break <code>.loki</code> DNS resolution. Websites like <a href=https://dnsleaktest.com>DNS leak test</a> can observe which DNS server you are actually using and potentially fingerprint you. For the same reason that you should not use custom DNS servers when connected to the Tor network, you really should not use a custom DNS server when connected to Lokinet.</p><p>Start by importing the Oxen&rsquo;s PGP key:</p><p><code>sudo curl --proxy http://127.0.0.1:8082 -so /etc/apt/trusted.gpg.d/oxen.gpg https://deb.oxen.io/pub.gpg</code></p><p>Then, add Oxen&rsquo;s Debian repository:</p><p><code>echo "deb https://deb.oxen.io $(lsb_release -sc) main" | sudo tee /etc/apt/sources.list.d/oxen.list</code></p><p>Next, update the repositories:</p><p><code>sudo apt update</code></p><p>If updates for your packages are found, <strong>DO NOT</strong> attempt to upgrade them directly. Instead, use the Qubes Updater to update the TemplateVM.</p><p>When you are done, install <code>lokinet-gui</code> and <code>resolvconf</code>:</p><p><code>sudo apt install lokinet-gui resolvconf</code></p><p>Note that you <strong>must</strong> install <code>resolveconf</code> to get DNS working.</p><p>Next, edit <code>/var/lib/lokinet/lokinet.ini</code> and add the exit server you want to use:</p><p><code>exit-node=exit.loki</code></p><p>Note that I am using <code>exit.loki</code> here, as it is the one mentioned in the <a href=https://docs.oxen.io/products-built-on-oxen/lokinet/exit-nodes>Lokinet documentation</a>.
There are some other exit servers listed on <a href="http://probably.loki/wiki/index.php?title=Exit_Nodes">probably.loki</a> as well, and for your convenience, I will just copy-paste them here:</p><ul><li><code>exit.loki</code> (USA, run by Jeff)</li><li><code>exit2.loki</code> (USA, run by Jeff, same ip as exit.loki)</li><li><code>xite.loki</code> (Iceland, run by Loutchi)</li><li><code>peter.loki</code> (USA, run by peter)</li><li><code>secret.loki</code> (Netherlands, run by Secret)</li></ul><p>Finally, enable the <code>lokinet</code> service:</p><p><code>systemctl enable lokinet</code></p><h2 id=creating-the-appvm>Creating the AppVM<a hidden class=anchor aria-hidden=true href=#creating-the-appvm>#</a></h2><p>Just create the AppVM as usual, and you would be good to go. There are a few things to keep in mind though:</p><ul><li>You should probably set networking to use <code>sys-firewall</code>. I have tested using my ProtonVPN ProxyVM for networking, and DNS was not working. Besides, it makes little sense to attempt such setup anyways, unless you are worried about accidental leaks or a compromised AppVM.</li><li>You should give the AppVM the <code>network-manager</code> service so that Lokinet can set up networking properly and get DNS working.</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://privsec.dev/tags/applications/>Applications</a></li><li><a href=https://privsec.dev/tags/qubes-os/>Qubes OS</a></li><li><a href=https://privsec.dev/tags/anonymity/>Anonymity</a></li><li><a href=https://privsec.dev/tags/privacy/>Privacy</a></li></ul><nav class=paginav><a class=prev href=https://privsec.dev/posts/qubes/firewalling-with-mirageos-on-qubes-os/><span class=title>« Prev</span><br><span>Firewalling with MirageOS on Qubes OS</span></a>
<a class=next href=https://privsec.dev/posts/qubes/using-mullvad-vpn-on-qubes-os/><span class=title>Next »</span><br><span>Using Mullvad VPN on Qubes OS</span></a></nav></footer></article></main><footer class=footer><span><a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA 4.0</a></span>
<span>- Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer">Hugo</a> &
        <a href=https://github.com/Wonderfall/hugo-WonderMod/ rel=noopener>WonderMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script defer crossorigin=anonymous src=/assets/js/papermod.7ea300eda6d3653624a576fbc095ccd8a0c2977756acbe5de4114132a72cc7fa.js integrity="sha256-fqMA7abTZTYkpXb7wJXM2KDCl3dWrL5d5BFBMqcsx/o="></script></body></html>