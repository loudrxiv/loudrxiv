<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Using Mullvad VPN on Qubes OS | PrivSec - A practical approach to Privacy and Security</title><meta name=keywords content="Applications,Qubes OS,Privacy"><meta name=description content="Mullvad is a fairly popular and generally trustworthy VPN provider. In this post, I will walk you through how to use the official Mullvad client in a ProxyVM on Qubes OS. This method is a lot more convenient than the official guide from Mullvad (which recommends that you manually load in OpenVPN or Wireguard profiles) and will let you seamlessly switch between different location and network setups just as you would on a normal Linux installation."><meta name=author content="Tommy"><link rel=canonical href=https://privsec.dev/posts/qubes/using-mullvad-vpn-on-qubes-os/><link crossorigin=anonymous href=/assets/css/stylesheet.c5277e43fde8b6dabe803dff75b3c935ba15f1a218d18c0bcbaba3460636ce74.css integrity="sha256-xSd+Q/3ottq+gD3/dbPJNboV8aIY0YwLy6ujRgY2znQ=" rel="preload stylesheet" as=style><noscript><link crossorigin=anonymous href=/css/includes/noscript.30127fa68e36d08f5dd7f9d4e717dac42e729b844672afd0fbcacb0d9e508595.css integrity="sha256-MBJ/po420I9d1/nU5xfaxC5ym4RGcq/Q+8rLDZ5QhZU=" rel="preload stylesheet" as=style></noscript><link rel=icon href=https://privsec.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://privsec.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://privsec.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://privsec.dev/apple-touch-icon.png><link rel=mask-icon href=https://privsec.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta property="og:title" content="Using Mullvad VPN on Qubes OS"><meta property="og:description" content="Mullvad is a fairly popular and generally trustworthy VPN provider. In this post, I will walk you through how to use the official Mullvad client in a ProxyVM on Qubes OS. This method is a lot more convenient than the official guide from Mullvad (which recommends that you manually load in OpenVPN or Wireguard profiles) and will let you seamlessly switch between different location and network setups just as you would on a normal Linux installation."><meta property="og:type" content="article"><meta property="og:url" content="https://privsec.dev/posts/qubes/using-mullvad-vpn-on-qubes-os/"><meta property="og:image" content="https://privsec.dev/privsec.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-03T00:00:00+00:00"><meta property="article:modified_time" content="2023-02-04T16:21:06-05:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://privsec.dev/privsec.png"><meta name=twitter:title content="Using Mullvad VPN on Qubes OS"><meta name=twitter:description content="Mullvad is a fairly popular and generally trustworthy VPN provider. In this post, I will walk you through how to use the official Mullvad client in a ProxyVM on Qubes OS. This method is a lot more convenient than the official guide from Mullvad (which recommends that you manually load in OpenVPN or Wireguard profiles) and will let you seamlessly switch between different location and network setups just as you would on a normal Linux installation."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Categories","item":"https://privsec.dev/posts/"},{"@type":"ListItem","position":3,"name":"Qubes OS","item":"https://privsec.dev/posts/qubes/"},{"@type":"ListItem","position":4,"name":"Using Mullvad VPN on Qubes OS","item":"https://privsec.dev/posts/qubes/using-mullvad-vpn-on-qubes-os/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Using Mullvad VPN on Qubes OS","name":"Using Mullvad VPN on Qubes OS","description":"Mullvad is a fairly popular and generally trustworthy VPN provider. In this post, I will walk you through how to use the official Mullvad client in a ProxyVM on Qubes OS. This method is a lot more convenient than the official guide from Mullvad (which recommends that you manually load in OpenVPN or Wireguard profiles) and will let you seamlessly switch between different location and network setups just as you would on a normal Linux installation.","keywords":["Applications","Qubes OS","Privacy"],"articleBody":"Mullvad is a fairly popular and generally trustworthy VPN provider. In this post, I will walk you through how to use the official Mullvad client in a ProxyVM on Qubes OS. This method is a lot more convenient than the official guide from Mullvad (which recommends that you manually load in OpenVPN or Wireguard profiles) and will let you seamlessly switch between different location and network setups just as you would on a normal Linux installation.\nPreparing your TemplateVM I recommend that you make a new TemplateVM based on latest Fedora template and remove all unnecessary packages that you might not use. This way, you can minimize the attack surface while not having to deal with missing dependencies like on a minimal template. With that being said, if you do manage to get the minimal template to fully work with Mullvad, feel free to open a discussion on GitHub or contact me directly and I will update the post accordingly.\nThis is what I run on my template to trim it down:\nsudo dnf remove firefox thunderbird totem gnome-remote-desktop gnome-calendar gnome-disk-utility gnome-calculator gnome-connections gnome-weather gnome-contacts gnome-clocks gnome-maps gnome-screenshot gnome-logs gnome-characters gnome-font-viewer gnome-color-manager simple-scan keepassxc cheese baobab yelp evince* httpd mozilla* cups rygel -y sudo dnf autoremove -y Next, you need to create the bind directories for Mullvadâ€™s configurations:\nsudo mkdir -p /etc/qubes-bind-dirs.d sudo tee /etc/qubes-bind-dirs.d/50_user.conf /dev/null binds+=( '/etc/mullvad-vpn' ) EOF Installing the Mullvad App Inside of the TemplateVM you have just created, do the following:\nsudo dnf install https://mullvad.net/media/app/MullvadVPN-2022.5_x86_64.rpm sudo systemctl enable mullvad-daemon Replace https://mullvad.net/media/app/MullvadVPN-2022.5_x86_64.rpm with whatever the latest URL for the Mullvad App is. I will try to update this post to give you the accurate command, but you should just take them from their website.\nShutdown the TemplateVM:\nsudo shutdown now Creating the ProxyVM Create an AppVM based on the TemplateVM you have just created. Set sys-firewall (or whatever FirewallVM you have connected to your sys-net) as the net qube. If you do not have such FirewallVM, use sys-net as the net qube. Next, go to the advanced tab and tick the provides network access to other qubes box.\nEdit /rw/config/rc.local to workaround issue 3803:\necho \"sleep 10 # Waiting a bit so that Mullvad can establish a connection /usr/lib/qubes/qubes-setup-dnat-to-ns\" | sudo tee -a /rw/config/rc.local Restart the ProxyVM. You can now use this ProxyVM as the net qube for other qubes!\nNotes With this current setup, the ProxyVM you have just created will be responsible for handling Firewall rules for the qubes behind it. This is not ideal, as this is still a fairly large VM, and there is a risk that Mullvad or some other apps may interfere with its firewall handling.\nInstead, I highly recommend that you create a minimal Mirage FirewallVM and use it as a firewall behind the Mullvad ProxyVM. Other AppVMs then should use the Mirage Firewall as the net qube instead. This way, you can make sure that firewall rules are properly enforced.\n","wordCount":"494","inLanguage":"en","datePublished":"2022-09-03T00:00:00Z","dateModified":"2023-02-04T16:21:06-05:00","author":{"@type":"Person","name":"Tommy"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://privsec.dev/posts/qubes/using-mullvad-vpn-on-qubes-os/"},"publisher":{"@type":"Organization","name":"PrivSec - A practical approach to Privacy and Security","logo":{"@type":"ImageObject","url":"https://privsec.dev/favicon.ico"}}}</script></head><body class=dark id=top><script crossorigin=anonymous src=/assets/js/theme.b20f95bb4da41ef90a2610a557a7000b2649a3f47282ec571676da6fc0427200.js integrity="sha256-sg+Vu02kHvkKJhClV6cACyZJo/RyguxXFnbab8BCcgA="></script><header class=header><div id=progressBar></div><nav class=nav><div class=logo><a href=https://privsec.dev accesskey=h title="PrivSec (Alt + H)"><img src=https://privsec.dev/privsec.png alt aria-label=logo height=30>PrivSec</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><input id=hamburger-input type=checkbox></input>
<label id=hamburger-menu for=hamburger-input></label><div class=overlay></div><ul id=menu><li><a href=https://privsec.dev/posts/ title=Categories><span>Categories</span></a></li><li><a href=https://privsec.dev/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://privsec.dev/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://privsec.dev/resources title=Resources><span>Resources</span></a></li><li><a href=https://tommytran.io/tommy.asc title=PGP><span>PGP</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://tommytran.io/tommy.crt title=S/MIME><span>S/MIME</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://privsec.dev>Home</a>&nbsp;Â»&nbsp;<a href=https://privsec.dev/posts/>Categories</a>&nbsp;Â»&nbsp;<a href=https://privsec.dev/posts/qubes/>Qubes OS</a></div><h1 class=post-title>Using Mullvad VPN on Qubes OS</h1><div class=post-meta><span title='2022-09-03 00:00:00 +0000 UTC'>September 3, 2022</span>&nbsp;Â·&nbsp;3 min&nbsp;Â·&nbsp;494 words&nbsp;Â·&nbsp;Tommy&nbsp;|&nbsp;<a href=https://github.com/PrivSec-dev/privsec.dev/blob/main/content/posts/qubes/Using%20Mullvad%20VPN%20on%20Qubes%20OS.md rel="noopener noreferrer">Suggest Changes</a></div><div class=post-meta><span title="2023-02-04 16:21:06 -0500 EST"><i>Last updated on February 4, 2023</i></span></div></header><div class="toc side"><details id=toc><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#preparing-your-templatevm aria-label="Preparing your TemplateVM">Preparing your TemplateVM</a></li><li><a href=#installing-the-mullvad-app aria-label="Installing the Mullvad App">Installing the Mullvad App</a></li><li><a href=#creating-the-proxyvm aria-label="Creating the ProxyVM">Creating the ProxyVM</a></li><li><a href=#notes aria-label=Notes>Notes</a></li></ul></div></details></div><div class=post-content><p><img loading=lazy src=/images/mullvad-vpn-1.png alt="Mullvad VPN"></p><p>Mullvad is a fairly popular and generally trustworthy VPN provider. In this post, I will walk you through how to use the official Mullvad client in a ProxyVM on Qubes OS. This method is a lot more convenient than the <a href=https://mullvad.net/en/help/qubes-os-4-and-mullvad-vpn/>official guide</a> from Mullvad (which recommends that you manually load in OpenVPN or Wireguard profiles) and will let you seamlessly switch between different location and network setups just as you would on a normal Linux installation.</p><h2 id=preparing-your-templatevm>Preparing your TemplateVM<a hidden class=anchor aria-hidden=true href=#preparing-your-templatevm>#</a></h2><p>I recommend that you make a new TemplateVM based on latest Fedora template and remove all unnecessary packages that you might not use. This way, you can minimize the attack surface while not having to deal with missing dependencies like on a minimal template. With that being said, if you do manage to get the minimal template to fully work with Mullvad, feel free to <a href=https://github.com/orgs/PrivSec-dev/discussions>open a discussion on GitHub</a> or <a href=https://tommytran.io/contact>contact me directly</a> and I will update the post accordingly.</p><p>This is what I run on my template to trim it down:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo dnf remove firefox thunderbird totem gnome-remote-desktop gnome-calendar gnome-disk-utility gnome-calculator gnome-connections gnome-weather gnome-contacts gnome-clocks gnome-maps gnome-screenshot gnome-logs gnome-characters gnome-font-viewer gnome-color-manager simple-scan keepassxc cheese baobab yelp evince* httpd mozilla* cups rygel -y
</span></span><span class=line><span class=cl>sudo dnf autoremove -y
</span></span></code></pre></div><p>Next, you need to create the bind directories for Mullvad&rsquo;s configurations:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo mkdir -p /etc/qubes-bind-dirs.d
</span></span><span class=line><span class=cl>sudo tee /etc/qubes-bind-dirs.d/50_user.conf <span class=s>&lt;&lt; EOF &gt; /dev/null
</span></span></span><span class=line><span class=cl><span class=s>binds+=( &#39;/etc/mullvad-vpn&#39; )
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></div><h2 id=installing-the-mullvad-app>Installing the Mullvad App<a hidden class=anchor aria-hidden=true href=#installing-the-mullvad-app>#</a></h2><p>Inside of the TemplateVM you have just created, do the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo dnf install https://mullvad.net/media/app/MullvadVPN-2022.5_x86_64.rpm
</span></span><span class=line><span class=cl>sudo systemctl <span class=nb>enable</span> mullvad-daemon
</span></span></code></pre></div><p>Replace <code>https://mullvad.net/media/app/MullvadVPN-2022.5_x86_64.rpm</code> with whatever the latest URL for the Mullvad App is. I will try to update this post to give you the accurate command, but you should just take them from <a href=https://mullvad.net/en/download/linux/>their website</a>.</p><p><img loading=lazy src=/images/mullvad-vpn-2.png alt="Mullvad VPN URL"></p><p>Shutdown the TemplateVM:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo shutdown now
</span></span></code></pre></div><h2 id=creating-the-proxyvm>Creating the ProxyVM<a hidden class=anchor aria-hidden=true href=#creating-the-proxyvm>#</a></h2><p>Create an AppVM based on the TemplateVM you have just created. Set <code>sys-firewall</code> (or whatever FirewallVM you have connected to your <code>sys-net</code>) as the net qube. If you do not have such FirewallVM, use <code>sys-net</code> as the net qube. Next, go to the advanced tab and tick the <code>provides network access to other qubes</code> box.</p><p><img loading=lazy src=/images/provides-network.png alt="Provides Network"></p><p>Edit <code>/rw/config/rc.local</code> to workaround <a href=https://github.com/mullvad/mullvadvpn-app/issues/3803>issue 3803</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;sleep 10 # Waiting a bit so that Mullvad can establish a connection
</span></span></span><span class=line><span class=cl><span class=s2>/usr/lib/qubes/qubes-setup-dnat-to-ns&#34;</span> <span class=p>|</span> sudo tee -a /rw/config/rc.local
</span></span></code></pre></div><p>Restart the ProxyVM. You can now use this ProxyVM as the net qube for other qubes!</p><h2 id=notes>Notes<a hidden class=anchor aria-hidden=true href=#notes>#</a></h2><p>With this current setup, the ProxyVM you have just created will be responsible for handling Firewall rules for the qubes behind it. This is not ideal, as this is still a fairly large VM, and there is a risk that Mullvad or some other apps may interfere with its firewall handling.</p><p>Instead, I highly recommend that you <a href=/posts/qubes/firewalling-with-mirageos-on-qubes-os/>create a minimal Mirage FirewallVM</a> and use it as a firewall <strong>behind</strong> the Mullvad ProxyVM. Other AppVMs then should use the Mirage Firewall as the net qube instead. This way, you can make sure that firewall rules are properly enforced.</p><p><img loading=lazy src=/images/mirageos.png alt=MirageOS></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://privsec.dev/tags/applications/>Applications</a></li><li><a href=https://privsec.dev/tags/qubes-os/>Qubes OS</a></li><li><a href=https://privsec.dev/tags/privacy/>Privacy</a></li></ul><nav class=paginav><a class=prev href=https://privsec.dev/posts/qubes/using-lokinet-on-qubes-os/><span class=title>Â« Prev</span><br><span>Using Lokinet on Qubes OS</span></a>
<a class=next href=https://privsec.dev/posts/qubes/using-split-gpg-and-split-ssh-on-qubes-os/><span class=title>Next Â»</span><br><span>Using Split GPG and Split SSH on Qubes OS</span></a></nav></footer></article></main><footer class=footer><span><a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA 4.0</a></span>
<span>- Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer">Hugo</a> &
        <a href=https://github.com/Wonderfall/hugo-WonderMod/ rel=noopener>WonderMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script defer crossorigin=anonymous src=/assets/js/papermod.7ea300eda6d3653624a576fbc095ccd8a0c2977756acbe5de4114132a72cc7fa.js integrity="sha256-fqMA7abTZTYkpXb7wJXM2KDCl3dWrL5d5BFBMqcsx/o="></script></body></html>