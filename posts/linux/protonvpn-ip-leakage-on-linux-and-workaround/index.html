<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ProtonVPN IP Leakage on Linux and Workaround | A loudrxiv - A website for the academically-stunted</title><meta name=keywords content="Applications,Linux,Qubes OS,Privacy"><meta name=description content="Before We Start&mldr;
I sent Proton an email regarding this issue in late August 2022 and was told they are working on fixing it, though it will take some time as it requires some architectural changes in how the killswitch works.
The Leak Ideally, when implementing a killswitch, a VPN client should drop all connections on non-VPN interfaces except when the connection is to the VPN provider&rsquo;s servers. This is necessary to prevent accidental leaks, at least by unprivileged applications."><meta name=author content="Tommy"><link rel=canonical href=https://loudrxiv.github.io/posts/linux/protonvpn-ip-leakage-on-linux-and-workaround/><link crossorigin=anonymous href=/assets/css/stylesheet.c5277e43fde8b6dabe803dff75b3c935ba15f1a218d18c0bcbaba3460636ce74.css integrity="sha256-xSd+Q/3ottq+gD3/dbPJNboV8aIY0YwLy6ujRgY2znQ=" rel="preload stylesheet" as=style><noscript><link crossorigin=anonymous href=/css/includes/noscript.30127fa68e36d08f5dd7f9d4e717dac42e729b844672afd0fbcacb0d9e508595.css integrity="sha256-MBJ/po420I9d1/nU5xfaxC5ym4RGcq/Q+8rLDZ5QhZU=" rel="preload stylesheet" as=style></noscript><link rel=icon href=https://loudrxiv.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://loudrxiv.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://loudrxiv.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://loudrxiv.github.io/apple-touch-icon.png><link rel=mask-icon href=https://loudrxiv.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta property="og:title" content="ProtonVPN IP Leakage on Linux and Workaround"><meta property="og:description" content="Before We Start&mldr;
I sent Proton an email regarding this issue in late August 2022 and was told they are working on fixing it, though it will take some time as it requires some architectural changes in how the killswitch works.
The Leak Ideally, when implementing a killswitch, a VPN client should drop all connections on non-VPN interfaces except when the connection is to the VPN provider&rsquo;s servers. This is necessary to prevent accidental leaks, at least by unprivileged applications."><meta property="og:type" content="article"><meta property="og:url" content="https://loudrxiv.github.io/posts/linux/protonvpn-ip-leakage-on-linux-and-workaround/"><meta property="og:image" content="https://loudrxiv.github.io/waving_snail.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-10-08T00:00:00+00:00"><meta property="article:modified_time" content="2023-02-04T16:21:06-05:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://loudrxiv.github.io/waving_snail.png"><meta name=twitter:title content="ProtonVPN IP Leakage on Linux and Workaround"><meta name=twitter:description content="Before We Start&mldr;
I sent Proton an email regarding this issue in late August 2022 and was told they are working on fixing it, though it will take some time as it requires some architectural changes in how the killswitch works.
The Leak Ideally, when implementing a killswitch, a VPN client should drop all connections on non-VPN interfaces except when the connection is to the VPN provider&rsquo;s servers. This is necessary to prevent accidental leaks, at least by unprivileged applications."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Categories","item":"https://loudrxiv.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Linux","item":"https://loudrxiv.github.io/posts/linux/"},{"@type":"ListItem","position":4,"name":"ProtonVPN IP Leakage on Linux and Workaround","item":"https://loudrxiv.github.io/posts/linux/protonvpn-ip-leakage-on-linux-and-workaround/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ProtonVPN IP Leakage on Linux and Workaround","name":"ProtonVPN IP Leakage on Linux and Workaround","description":"Before We Start\u0026hellip;\nI sent Proton an email regarding this issue in late August 2022 and was told they are working on fixing it, though it will take some time as it requires some architectural changes in how the killswitch works.\nThe Leak Ideally, when implementing a killswitch, a VPN client should drop all connections on non-VPN interfaces except when the connection is to the VPN provider\u0026rsquo;s servers. This is necessary to prevent accidental leaks, at least by unprivileged applications.","keywords":["Applications","Linux","Qubes OS","Privacy"],"articleBody":"Before We Start…\nI sent Proton an email regarding this issue in late August 2022 and was told they are working on fixing it, though it will take some time as it requires some architectural changes in how the killswitch works.\nThe Leak Ideally, when implementing a killswitch, a VPN client should drop all connections on non-VPN interfaces except when the connection is to the VPN provider’s servers. This is necessary to prevent accidental leaks, at least by unprivileged applications. Unfortunately, the ProtonVPN client does not currently do this.\nEffectively, any application that binds to the connected physical interface (as opposed to the VPN’s virtual interface) on your Linux system will expose your actual IP address, regardless of the killswitch state. This is problematic, especially for certain applications like Torrent clients, as they tend to use whatever interfaces they can access (rather than just the default one) to connect to the internet. You can check this with curl:\ncurl --interface https://ipinfo.io This will return your actual IP address.\nThe Workaround Qubes OS On Qubes OS, you generally should not have a problem if you use the ProtonVPN client in a ProxyVM. While the same issue still exists within the ProxyVM itself, it is unlikely to manifest as you should not be running any other applications in the same Qube anyways, and apps in an AppVM cannot bind to the public interface of the ProxyVM. I have not observed any leaks from an AppVM behind a ProtonVPN ProxyVM.\nGeneral Linux Distributions On a general Linux distribution, the workaround is to configure OpenVPN manually and setup a killswitch yourself.\nSince ProtonVPN does not support IPv6, you should disable it in your kernel settings:\necho 'net.ipv6.conf.all.disable_ipv6=1 net.ipv6.conf.default.disable_ipv6=1 net.ipv6.conf.lo.disable_ipv6=1' | sudo tee /etc/sysctl.d/10-disable-ipv6.conf sudo sysctl -p Next, download your OpenVPN configuration files from account.protonvpn.com. In those configuration files, you should see a list of IP addresses and ports of ProtonVPN’s servers.\nFinally, set up the VPN killswitch. The rules I posted here are based on this discussion.\nFirewalld sudo firewall-cmd --direct --permanent --add-rule ipv4 filter FORWARD 0 -o tun+ -j ACCEPT sudo firewall-cmd --direct --permanent --add-rule ipv4 filter FORWARD 0 -i tun+ -j ACCEPT sudo firewall-cmd --direct --permanent --add-rule ipv6 filter INPUT 0 -j DROP sudo firewall-cmd --direct --permanent --add-rule ipv4 filter INPUT 0 -i lo -j ACCEPT sudo firewall-cmd --direct --permanent --add-rule ipv4 filter INPUT 1 -i tun+ -p tcp -j ACCEPT sudo firewall-cmd --direct --permanent --add-rule ipv4 filter INPUT 1 -i tun+ -p udp -j ACCEPT sudo firewall-cmd --direct --permanent --add-rule ipv4 filter INPUT 999 -j DROP sudo firewall-cmd --direct --permanent --add-rule ipv6 filter OUTPUT 0 -j DROP sudo firewall-cmd --direct --permanent --add-rule ipv4 filter OUTPUT 0 -o lo -j ACCEPT sudo firewall-cmd --direct --permanent --add-rule ipv4 filter OUTPUT 0 -o tun+ -j ACCEPT #You will need to add each of the IP address and port with the following command: sudo firewall-cmd --direct --permanent --add-rule ipv4 filter OUTPUT 1 -p udp -m udp --dport $PORT -d $IP -j ACCEPT sudo firewall-cmd --direct --permanent --add-rule ipv4 filter OUTPUT 999 -j DROP sudo firewall-cmd --reload UFW sudo ufw default deny incoming sudo ufw default deny outgoing #You will need to add each of the IP address and port with the following command: sudo ufw allow out to $IP port $PORT proto udp sudo ufw allow out on tun0 from any to any ","wordCount":"560","inLanguage":"en","datePublished":"2022-10-08T00:00:00Z","dateModified":"2023-02-04T16:21:06-05:00","author":{"@type":"Person","name":"Tommy"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://loudrxiv.github.io/posts/linux/protonvpn-ip-leakage-on-linux-and-workaround/"},"publisher":{"@type":"Organization","name":"A loudrxiv - A website for the academically-stunted","logo":{"@type":"ImageObject","url":"https://loudrxiv.github.io/favicon.ico"}}}</script></head><body class=dark id=top><script crossorigin=anonymous src=/assets/js/theme.b20f95bb4da41ef90a2610a557a7000b2649a3f47282ec571676da6fc0427200.js integrity="sha256-sg+Vu02kHvkKJhClV6cACyZJo/RyguxXFnbab8BCcgA="></script><header class=header><div id=progressBar></div><nav class=nav><div class=logo><a href=https://loudrxiv.github.io accesskey=h title="loudRxiv (Alt + H)"><img src=https://loudrxiv.github.io/snail.gif alt aria-label=logo height=30>loudRxiv</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><input id=hamburger-input type=checkbox></input>
<label id=hamburger-menu for=hamburger-input></label><div class=overlay></div><ul id=menu><li><a href=https://loudrxiv.github.io/posts/ title=Categories><span>Categories</span></a></li><li><a href=https://loudrxiv.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://loudrxiv.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://loudrxiv.github.io/resources title=Resources><span>Resources</span></a></li><li><a href=https://tommytran.io/tommy.asc title=PGP><span>PGP</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://tommytran.io/tommy.crt title=S/MIME><span>S/MIME</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://loudrxiv.github.io>Home</a>&nbsp;»&nbsp;<a href=https://loudrxiv.github.io/posts/>Categories</a>&nbsp;»&nbsp;<a href=https://loudrxiv.github.io/posts/linux/>Linux</a></div><h1 class=post-title>ProtonVPN IP Leakage on Linux and Workaround</h1><div class=post-meta><span title='2022-10-08 00:00:00 +0000 UTC'>October 8, 2022</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;560 words&nbsp;·&nbsp;Tommy&nbsp;|&nbsp;<a href=https://github.com/PrivSec-dev/privsec.dev/blob/main/content/posts/linux/ProtonVPN%20IP%20Leakage%20on%20Linux%20and%20Workaround.md rel="noopener noreferrer">Suggest Changes</a></div><div class=post-meta><span title="2023-02-04 16:21:06 -0500 -0500"><i>Last updated on February 4, 2023</i></span></div></header><div class="toc side"><details id=toc><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#the-leak aria-label="The Leak">The Leak</a></li><li><a href=#the-workaround aria-label="The Workaround">The Workaround</a><ul><li><a href=#qubes-os aria-label="Qubes OS">Qubes OS</a></li><li><a href=#general-linux-distributions aria-label="General Linux Distributions">General Linux Distributions</a><ul><li><a href=#firewalld aria-label=Firewalld>Firewalld</a></li><li><a href=#ufw aria-label=UFW>UFW</a></li></ul></li></ul></li></ul></div></details></div><div class=post-content><p><strong>Before We Start</strong>&mldr;</p><p>I sent Proton an email regarding this issue in late August 2022 and was told they are working on fixing it, though it will take some time as it requires some architectural changes in how the killswitch works.</p><h2 id=the-leak>The Leak<a hidden class=anchor aria-hidden=true href=#the-leak>#</a></h2><p>Ideally, when implementing a killswitch, a VPN client should drop all connections on non-VPN interfaces except when the connection is to the VPN provider&rsquo;s servers. This is necessary to prevent accidental leaks, at least by unprivileged applications. Unfortunately, the ProtonVPN client does not currently do this.</p><p>Effectively, any application that binds to the connected physical interface (as opposed to the VPN&rsquo;s virtual interface) on your Linux system will expose your actual IP address, regardless of the killswitch state. This is problematic, especially for certain applications like Torrent clients, as they tend to use whatever interfaces they can access (rather than just the default one) to connect to the internet.
You can check this with <code>curl</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl --interface &lt;physical interface&gt; https://ipinfo.io
</span></span></code></pre></div><p>This will return your actual IP address.</p><h2 id=the-workaround>The Workaround<a hidden class=anchor aria-hidden=true href=#the-workaround>#</a></h2><h3 id=qubes-os>Qubes OS<a hidden class=anchor aria-hidden=true href=#qubes-os>#</a></h3><p>On Qubes OS, you generally should not have a problem if you use the ProtonVPN client in a ProxyVM. While the same issue still exists within the ProxyVM itself, it is unlikely to manifest as you should not be running any other applications in the same Qube anyways, and apps in an AppVM cannot bind to the public interface of the ProxyVM. I have not observed any leaks from an AppVM behind a ProtonVPN ProxyVM.</p><h3 id=general-linux-distributions>General Linux Distributions<a hidden class=anchor aria-hidden=true href=#general-linux-distributions>#</a></h3><p>On a general Linux distribution, the workaround is to configure OpenVPN manually and setup a killswitch yourself.</p><p>Since ProtonVPN does not support IPv6, you should disable it in your kernel settings:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;net.ipv6.conf.all.disable_ipv6=1
</span></span></span><span class=line><span class=cl><span class=s1>net.ipv6.conf.default.disable_ipv6=1
</span></span></span><span class=line><span class=cl><span class=s1>net.ipv6.conf.lo.disable_ipv6=1&#39;</span> <span class=p>|</span> sudo tee /etc/sysctl.d/10-disable-ipv6.conf
</span></span><span class=line><span class=cl>sudo sysctl -p
</span></span></code></pre></div><p>Next, download your OpenVPN configuration files from <a href=https://account.protonvpn.com/>account.protonvpn.com</a>. In those configuration files, you should see a list of IP addresses and ports of ProtonVPN&rsquo;s servers.</p><p>Finally, set up the VPN killswitch. The rules I posted here are based on <a href=https://airvpn.org/forums/topic/15061-firewalld-killswitch/>this discussion</a>.</p><h4 id=firewalld>Firewalld<a hidden class=anchor aria-hidden=true href=#firewalld>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo firewall-cmd --direct --permanent --add-rule ipv4 filter FORWARD <span class=m>0</span> -o tun+ -j ACCEPT
</span></span><span class=line><span class=cl>sudo firewall-cmd --direct --permanent --add-rule ipv4 filter FORWARD <span class=m>0</span> -i tun+ -j ACCEPT
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo firewall-cmd --direct --permanent --add-rule ipv6 filter INPUT <span class=m>0</span> -j DROP
</span></span><span class=line><span class=cl>sudo firewall-cmd --direct --permanent --add-rule ipv4 filter INPUT <span class=m>0</span> -i lo -j ACCEPT
</span></span><span class=line><span class=cl>sudo firewall-cmd --direct --permanent --add-rule ipv4 filter INPUT <span class=m>1</span> -i tun+ -p tcp -j ACCEPT
</span></span><span class=line><span class=cl>sudo firewall-cmd --direct --permanent --add-rule ipv4 filter INPUT <span class=m>1</span> -i tun+ -p udp -j ACCEPT
</span></span><span class=line><span class=cl>sudo firewall-cmd --direct --permanent --add-rule ipv4 filter INPUT <span class=m>999</span> -j DROP
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo firewall-cmd --direct --permanent --add-rule ipv6 filter OUTPUT <span class=m>0</span> -j DROP
</span></span><span class=line><span class=cl>sudo firewall-cmd --direct --permanent --add-rule ipv4 filter OUTPUT <span class=m>0</span> -o lo -j ACCEPT
</span></span><span class=line><span class=cl>sudo firewall-cmd --direct --permanent --add-rule ipv4 filter OUTPUT <span class=m>0</span> -o tun+ -j ACCEPT
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#You will need to add each of the IP address and port with the following command:</span>
</span></span><span class=line><span class=cl>sudo firewall-cmd --direct --permanent --add-rule ipv4 filter OUTPUT <span class=m>1</span> -p udp -m udp --dport <span class=nv>$PORT</span> -d <span class=nv>$IP</span> -j ACCEPT
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo firewall-cmd --direct --permanent --add-rule ipv4 filter OUTPUT <span class=m>999</span> -j DROP
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo firewall-cmd --reload
</span></span></code></pre></div><h4 id=ufw>UFW<a hidden class=anchor aria-hidden=true href=#ufw>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo ufw default deny incoming
</span></span><span class=line><span class=cl>sudo ufw default deny outgoing
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#You will need to add each of the IP address and port with the following command:</span>
</span></span><span class=line><span class=cl>sudo ufw allow out to <span class=nv>$IP</span> port <span class=nv>$PORT</span> proto udp
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo ufw allow out on tun0 from any to any
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://loudrxiv.github.io/tags/applications/>Applications</a></li><li><a href=https://loudrxiv.github.io/tags/linux/>Linux</a></li><li><a href=https://loudrxiv.github.io/tags/qubes-os/>Qubes OS</a></li><li><a href=https://loudrxiv.github.io/tags/privacy/>Privacy</a></li></ul><nav class=paginav><a class=prev href=https://loudrxiv.github.io/posts/linux/networkmanager-trackability-reduction/><span class=title>« Prev</span><br><span>NetworkManager Trackability Reduction</span></a>
<a class=next href=https://loudrxiv.github.io/posts/linux/securing-openssh-with-fido2/><span class=title>Next »</span><br><span>Securing OpenSSH with FIDO2</span></a></nav></footer></article></main><footer class=footer><span><a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA 4.0</a></span>
<span>- Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer">Hugo</a> &
        <a href=https://github.com/Wonderfall/hugo-WonderMod/ rel=noopener>WonderMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script defer crossorigin=anonymous src=/assets/js/papermod.7ea300eda6d3653624a576fbc095ccd8a0c2977756acbe5de4114132a72cc7fa.js integrity="sha256-fqMA7abTZTYkpXb7wJXM2KDCl3dWrL5d5BFBMqcsx/o="></script></body></html>